---
title: Subagents
weight: 3
date: 2026-02-09T23:34:00+08:00
---

`subagents` 的价值是“**换脑子**”：把某类任务的角色、目标、输出格式与权限边界隔离出来，让它像专职同事一样稳定完成长链路工作。

## 为什么使用 Subagents

Subagents 帮助你：

- 保留上下文 - 将探索和实现保留在独立上下文中，不污染主对话
- 强制约束 - 限制 Subagent 可使用的工具
- 复用配置 - 用户级 Subagent 跨项目可用
- 专业化行为 - 使用专注的系统提示处理特定领域
- 控制成本 - 将任务路由到更快、更便宜的模型如 Haiku

## 内置 Subagents

Claude Code 包含以下内置 Subagent，Claude 会在适当时自动使用：

### Explore
快速、只读的代理，优化用于搜索和分析代码库。

模型：Haiku（快速、低延迟）
工具：只读工具（禁止 Write 和 Edit）
用途：文件发现、代码搜索、代码库探索

Claude 在需要搜索或理解代码库但不做修改时委托给 Explore。

### Plan
计划模式下使用的研究代理，在呈现计划之前收集上下文。

模型：继承主对话模型
工具：只读工具
用途：规划阶段的代码库研究

### general-purpose
通用代理，处理需要探索和操作的复杂多步任务。

## 一句话定位

`subagents` 负责回答：**这件事需要换角色/隔离权限/治理过程，让输出更稳定。**

## 适用场景

- **需要专职角色**：架构评审、代码审查、安全审计、复杂排障、发布把关。
- **链路长/步骤多**：需要更强的过程治理（阶段划分、停顿点、验收项）。
- **需要权限隔离**：例如只允许做只读分析，或所有写入/执行都需要二次确认。
- **需要降低上下文污染**：把子任务从主对话拆出去。

## 快速决策

一个好用的区分法是：

- **skills 改变的是“知道什么”（SOP/清单/方法论）**。
- **subagent 改变的是“谁在干活”（角色/权限/工作流/输出契约）**。

当你遇到以下信号，优先 subagent：

- 需要做**方案权衡**，并给出取舍理由。
- 需要做**审查/把关**（质量、安全、边界、兼容性）。
- 需要做**复杂排障**（多轮假设验证、反复收集证据）。
- 需要**严格的输入/输出格式**，否则无法落地。
- 需要**权限隔离**：例如只读分析/禁止写入/外部请求需确认。
- 主对话上下文容易被污染：需要把子任务拆出去并行探索。

## 最小可用模板（输入/输出契约）

你可以把 subagent 设计成一个有契约的“工单处理器”：

1. **输入（必须提供/必须确认）**
   - 目标：要解决什么问题
   - 约束：不能做什么、必须满足什么
   - 上下文：相关片段（日志、代码、接口、复现步骤等）
2. **输出（必须产出）**
   - 结论/建议（可执行）
   - 变更清单（影响面）
   - 风险点与回滚策略
   - 验证步骤与验收标准
3. **工作流（固定阶段）**
   - 收集信息 -> 形成假设 -> 验证 -> 决策 -> 执行 -> 复盘
4. **权限边界**
   - 哪些动作需要二次确认（写入、执行、外部请求）

## 常见坑（反模式）

- **角色定义太泛**：等同“万能代理”，无法带来稳定性。
- **没有契约**：只输出大段解释，没有验收与可执行项。
- **把 subagent 当技能手册**：手册用 skills；需要治理过程与角色隔离时才用 subagent。

## 与其他模块的边界

- **subagents vs rules / 系统提示词**：rules 是底线，约束所有角色。
- **subagents vs skills**：skills 给 SOP；subagent 负责按角色执行并对结果负责。
- **subagents vs hooks**：hooks 是关键点自动化守卫；subagent 是完整任务的执行者。
- **subagents vs MCP**：MCP 提供外部能力；subagent 决定何时用、怎么用以及如何验证。

## 参考链接

- [Subagents 子代理](https://claudecn.com/docs/claude-code/advanced/subagents/)
