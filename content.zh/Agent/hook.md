---
title: Hook
weight: 5
date: 2026-02-09T23:34:00+08:00
---

Hooks 的价值在于：把你曾经踩过的坑（忘跑测试、dev server 没日志、误 push、console.log 遗留、文档碎片化）变成自动化护栏。下面挑选最通用的几类配方，并说明适用边界。

**注意**：Hooks 会直接影响你的工作流。建议先用"提醒型"，再逐步上"阻断型"。

Hook 脚本通常会用到 Claude Code 注入的环境变量：

- `$CLAUDE_TOOL_INPUT_FILE_PATH`：本次操作涉及的文件路径
- `$CLAUDE_TOOL_NAME`：触发的工具名称
- `$CLAUDE_PROJECT_DIR`：项目根目录

此外，PreToolUse 的"阻断"通常依赖退出码：`exit 2` 表示阻断当前工具调用。

## 什么是 Hook

`hooks` 的定位是"**必须发生什么**"：在关键节点自动执行守卫与校验，让系统更稳定、更可控，而不是让 Agent 做更多"聪明但不可控"的事。

## 一句话定位

`hooks` 负责回答：**在什么关键节点，要自动做哪些守卫/校验/记录？**

## 适用场景

- **强制校验**：在交付前必须完成验证（检查/测试/构建等）。
- **风险闸门**：高风险动作前必须二次确认，并明确影响范围。
- **一致性守卫**：关键输出必须包含某些字段（验收项、回滚方案、验证步骤）。
- **审计与记录**：对关键动作做可追溯记录。

## 快速决策

- 需要"总是生效的底线"：用 `rules`。
- 需要"在关键点自动发生"：用 `hooks`。
- 需要"按需加载的流程手册"：用 `skills`。
- 需要"专职角色执行长链路任务"：用 `subagents`。

## 常用分层（建议从守卫开始）

1. **守卫类**：阻断或要求确认（最推荐优先做）。
2. **记录类**：记录关键输入/输出摘要，便于审计与复盘。
3. **提醒类**：给出提示，但不强制阻断（避免过度自动化）。

## 最小可用模板（可复制）

一条好维护的 hook 建议写成"触发条件 + 行为 + 失败处理 + 记录"的结构：

1. **触发条件**
   - 发生了什么类型的动作/阶段
2. **守卫规则**
   - 允许什么、禁止什么
   - 需要确认时，必须展示什么信息（影响范围、变更摘要、风险点）
3. **失败处理**
   - 阻断并提示下一步
   - 或降级为提醒
4. **记录项（可选）**
   - 记录输入摘要、输出摘要、关键决策与验证结果

这里的关键是：hook 尽量只做"守卫与记录"，避免引入不可控的副作用。

## 常见坑（反模式）

- **过度自动化**：hook 做太多事，误触发后很难定位。
- **副作用不可控**：自动修改环境/文件却缺少回滚与审计。
- **用 hook 替代 rules**：hook 是执行点，不是底线本身。
- **一条 hook 管太多事**：难以评审、难以回滚。

## 与其他模块的边界

- **hooks vs commands**：commands 由你主动触发；hooks 被动自动触发。
- **hooks vs rules / 系统提示词**：rules 规定底线；hooks 让底线更容易被执行与审计。
- **hooks vs MCP**：hooks 决定何时必须调用外部能力；MCP 提供能力本身。

## 参考链接

- [Hooks 配方：把经验变成自动化护栏](https://claudecn.com/docs/claude-code/advanced/hooks-recipes/)
